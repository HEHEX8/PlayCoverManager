# PlayCover 外部ストレージ管理ツール

macOS Sequoia 15.1+ (Tahoe 26.0.1) 対応の統合管理ツール

## 🎯 概要

PlayCoverを外部ストレージで運用するための**オールインワン管理ツール**です。
初期セットアップからアプリインストール、ボリューム管理、完全リセットまで、すべての機能を統合しています。

## 📦 メインツール

### `0_PlayCover-ManagementTool.command`
**PlayCover統合管理ツール（v4.33.11）**

すべての機能を1つのスクリプトに統合した完全版です。

#### 🎛️ メイン機能

1. **初期セットアップ**
   - Apple Silicon Mac の確認
   - フルディスクアクセス権限の確認
   - Xcode Command Line Tools の確認とインストール
   - Homebrew の確認とインストール
   - PlayCover の確認とインストール（`brew install --cask playcover-community`）
   - 外部ストレージの選択
   - PlayCover メインボリュームの作成とマウント
   - マッピングファイルの作成

2. **IPA インストール**
   - IPA ファイルの選択（Finder ダイアログ）
   - アプリ情報の抽出（日本語名対応）
   - アプリ専用ボリュームの作成
   - ボリューム作成前の確認プロンプト
   - 既存アプリの検出とバージョン比較
   - アップデート確認プロンプト
   - 自動マウント（正しい位置に）
   - PlayCover へのインストール起動
   - マッピングファイルへの登録

3. **ボリューム管理**
   - **全ボリュームをマウント**
     - PlayCover メインボリュームの優先マウント
     - 全アプリボリュームの一括マウント
     - 誤った位置のボリュームを自動再マウント
     - 存在しないボリュームのクリーンアップ確認
   
   - **全ボリュームをアンマウント**
     - アプリボリュームの一括アンマウント
     - PlayCover メインボリュームのアンマウント
     - 結果サマリーの表示
   
   - **個別ボリューム操作**
     - リアルタイムステータス表示
       - ✅ 正常にマウント済み
       - ⚠️  別の場所にマウント中
       - ⭕ アンマウント済み
       - ❌ ボリュームが見つからない
     - 個別マウント/アンマウント/再マウント
     - 存在しないボリュームのマッピング削除
   
   - **ボリューム状態確認**
     - PlayCover メインボリュームの状態確認
     - 全アプリボリュームの詳細状態確認
     - 日本語名での分かりやすい表示
   
   - **ディスク全体を取り外し**
     - 全ボリュームの自動アンマウント
     - ディスク情報の表示
     - 安全な取り外し確認
     - 物理デバイスの取り外し準備

4. **🔥 超強力クリーンアップ（完全リセット）**
   - すべてのボリュームをアンマウント
   - すべてのコンテナを完全削除
   - PlayCover本体をアンインストール（`brew uninstall --cask playcover-community`）
   - PlayTools.frameworkを削除
   - キャッシュ・設定・ログを削除
   - APFSボリュームを削除（内蔵・外部両方）
   - マッピングファイルを削除
   - 二重確認システム（yes + DELETE ALL）
   - 削除前の完全プレビュー表示

**⚠️ 注意**: この操作は取り消せません！すべてのPlayCoverデータが削除されます。

---

## 🚀 使用方法

### 初回セットアップ
1. `0_PlayCover-ManagementTool.command` をダブルクリック
2. メインメニューで **[1] 初期セットアップ** を選択
3. 管理者パスワードを入力
4. 外部ストレージを選択
5. 必要なソフトウェアのインストールを確認
6. 完了を待つ

### アプリのインストール
1. `0_PlayCover-ManagementTool.command` をダブルクリック
2. メインメニューで **[2] IPAインストール** を選択
3. 管理者パスワードを入力
4. IPA ファイルを選択
5. ボリューム作成を確認
6. 既存アプリがあればアップデート確認
7. PlayCover でインストールを完了

### 日常的な管理
1. `0_PlayCover-ManagementTool.command` をダブルクリック
2. メインメニューで **[3] ボリューム管理** を選択
3. サブメニューから操作を選択
   - **[1] 全ボリュームをマウント**: Mac 起動後に実行
   - **[2] 全ボリュームをアンマウント**: Mac シャットダウン前に実行
   - **[3] 個別ボリューム操作**: 個別に管理が必要なとき
   - **[4] ボリューム状態確認**: 状態を確認したいとき
   - **[5] ディスク全体を取り外し**: 外部ストレージを取り外すとき

### 🔥 完全リセット（トラブル時）
1. `0_PlayCover-ManagementTool.command` をダブルクリック
2. メインメニューで **[3] ボリューム管理** を選択
3. サブメニューで **[6] 超強力クリーンアップ** を選択
4. 削除対象の完全プレビューを確認
5. `yes` と入力
6. `DELETE ALL` と入力して実行
7. 完了後、ターミナルが自動的に閉じる
8. **再セットアップが必要**: メインメニューの[1]から再実行

---

## 📄 マッピングファイル

`playcover-map.txt` - ボリュームとアプリの対応関係を記録

**フォーマット（タブ区切り）:**
```
VolumeName	BundleID	DisplayName
PlayCover	io.playcover.PlayCover	PlayCover
ZenlessZoneZero	com.HoYoverse.Nap	ゼンレスゾーンゼロ
HonkaiStarRail	com.HoYoverse.hkrpgoversea	崩壊：スターレイル
```

**特徴:**
- 3列構成（ボリューム名、Bundle ID、表示名）
- 日本語名または英語名を保存
- ボリューム管理機能で自動活用

---

## 🎨 UI デザイン

全機能で統一されたUIデザイン（RGB(28,28,28)背景最適化）：

### カラースキーム（高コントラスト対応）
- 🟢 **緑色** (#64FF64): 成功メッセージ、内蔵ストレージ
- 🔴 **赤色** (#FF6464): エラーメッセージ、削除操作
- 🟡 **黄色** (#FFFF64): 警告メッセージ、操作矢印
- 🔵 **青色** (#64B4FF): 情報メッセージ、外部ストレージ
- 💠 **シアン** (#64FFFF): セクション見出し、メニュー番号
- ⚪ **白色** (#FFFFFF): 重要テキスト、アプリ名
- 🌫️ **明灰** (#C8C8C8): 通常テキスト
- 🌑 **暗灰** (#969696): 補足情報、パス

### テキストスタイル
- **太字**: 重要な要素（アプリ名、数値、メニュー番号）
- **下線**: セクション見出し
- **薄暗く**: 補足情報（パス、Bundle ID、ステータス）
- **取り消し線**: 削除済み/見つからないアイテム

### メッセージアイコン
- ✅ 成功
- ❌ エラー
- ⚠️  警告
- ℹ️  情報
- ▶ ハイライト

### ステータスアイコン
- 🟢 正常動作中（緑丸 + マウント済）
- ⚠️  異常状態（黄三角 + マウント位置異常）
- ⚪️ アンマウント済み（白丸）
- ❌ 存在しない（赤×）
- 🔒 ロック中（南京錠 + ゴールド強調）

### ストレージ表示
- 🏠 内蔵ストレージ（緑色強調）
- 🔌 外部ストレージ（青色強調）
- → 移動方向（黄色矢印）

### レイアウト要素
- **セクション区切り**: 装飾的な罫線（━━━）
- **警告枠**: 目立つ枠線で囲む（════）
- **情報階層**: インデントと色の濃淡で階層表現

### 終了処理
- **成功時**: 3秒後に自動クローズ
- **エラー時**: Enter キー待ち（ログ確認のため）
- **クリーンアップ後**: 3秒後に自動終了（再セットアップが必要）

---

## 🔧 技術的な詳細

### PlayCover 外部アプリインストールシステム

#### 従来の問題
PlayCoverボリュームが未マウント状態でPlayCoverを起動すると、内蔵ストレージ側のコンテナにデータが作成され、外部ボリュームのマウントができなくなる問題がありました。

#### 解決方法
PlayCover.app本体を外部ストレージに配置し、/Applicationsにはシンボリックリンクのみを配置：

```bash
# 実体の配置場所
~/Library/Containers/io.playcover.PlayCover/PlayCover.app

# シンボリックリンク
/Applications/PlayCover.app -> ~/Library/Containers/io.playcover.PlayCover/PlayCover.app
```

#### メリット
- ✅ 外部ドライブ未接続時、PlayCoverは自動的に起動不可
- ✅ Spotlight、Launchpad での検索は正常に動作
- ✅ 誤起動による内部ストレージデータ作成を完全に防止
- ✅ マウント時に自動でシンボリックリンクを検証・再作成

### マウントオプション
すべてのボリュームは `nobrowse` オプションでマウントされ、Finder のサイドバーやデスクトップに表示されません。

```bash
sudo mount -t apfs -o nobrowse /dev/diskXsY ~/Library/Containers/[BundleID]
```

### ボリューム配置
- **PlayCover メインボリューム**: `~/Library/Containers/io.playcover.PlayCover`
- **PlayCover アプリ本体**: `~/Library/Containers/io.playcover.PlayCover/PlayCover.app`
- **アプリボリューム**: `~/Library/Containers/[各アプリのBundleID]`

### 自動修正機能
ボリューム管理機能は、誤った位置にマウントされているボリュームを検出し、自動的に正しい位置に再マウントします。また、シンボリックリンクの破損も自動検出・修復します。

### Homebrewによる管理
PlayCover本体は公式の方法でインストール・アンインストールされます：
```bash
# インストール
brew install --cask playcover-community

# アンインストール（超強力クリーンアップ時）
brew uninstall --cask playcover-community
```

---

## ⚠️ 注意事項

### 必須要件
- Apple Silicon Mac（M1/M2/M3/M4シリーズ）
- macOS Sequoia 15.1 (Tahoe 26.0.1) 以降
- フルディスクアクセス権限（ターミナル.app）
- 外部ストレージ（USB/Thunderbolt/SSD）

### 推奨事項
- PlayCover を使用する際は必ずボリュームをマウントしてください
- Mac シャットダウン前には必ずボリュームをアンマウントしてください
- 外部ストレージを物理的に取り外す前に「ディスク全体を取り外し」を実行してください
- **外部ドライブ未接続時**: PlayCover.app はシンボリックリンクのため起動できません（正常動作）

### トラブルシューティング
- **ボリュームが見つからない**: ボリューム管理 → 状態確認
- **マウントエラー**: ボリューム管理 → 個別操作で再マウント
- **デスクトップに表示される**: 既存のマウントをアンマウントして再マウント
- **アプリが起動しない**: ボリュームが正しくマウントされているか確認
- **PlayCoverが起動できない**: 外部ストレージが接続されているか確認
- **内蔵ストレージにデータ有**: PlayCoverボリュームをアンマウントして、内部データを削除
- **🔥 すべてのアプリがクラッシュする**: 超強力クリーンアップを実行（詳細は `docs/guides/NUCLEAR_CLEANUP_GUIDE.md` を参照）
- **外部ボリューム再マウント後にクラッシュ**: 超強力クリーンアップで外部ボリュームの古いデータを完全削除

---

## 📂 プロジェクト構造

```
webapp/
├── 0_PlayCover-ManagementTool.command  # メイン統合ツール
├── README.md                            # このファイル
├── CHANGELOG.md                         # 詳細な更新履歴
├── docs/                                # ドキュメント
│   ├── archive/                         # 古いバグ修正・変更履歴
│   ├── guides/                          # ユーザー向けガイド
│   └── development/                     # 開発用ドキュメント
├── debug/                               # デバッグツール・ログファイル
└── archive/                             # 古いリリース・バックアップ
```

---

## 🔄 更新履歴（最近の主要版）

### v4.33.5 (最新) - Improved Wrong Mount Location Handling with Auto-Remount
- 🔧 **個別ボリューム操作の改善**: マウント位置異常時の動作を直感的に変更
  * 修正前: 番号選択 → アンマウント（誤った位置から外れるだけ）
  * 修正後: 番号選択 → **自動的に正しい位置へ再マウント**
- 🎯 **動作の最適化**:
  * 正しい位置にマウント済み: 選択 → アンマウント（トグル動作）
  * 誤った位置にマウント中: 選択 → **再マウント**（アンマウント＋マウント）
  * 未マウント: 選択 → マウント
- 📊 **ストレージ切替UIの表示改善**:
  * 修正前: 「使用容量: 現在のマウント位置: /Volumes/...」← 冗長
  * 修正後: 「使用容量: 8.0K | 誤ったマウント位置: /Volumes/...」← 簡潔
- ✨ **ユーザー体験の向上**:
  * マウント位置異常を発見 → 1クリックで修正完了
  * 手動でアンマウント→再マウントする必要がない
  * 期待通りの直感的な動作

### v4.33.4 - Fixed Storage Mode Detection for Wrong Mount Location
- 🐛 **誤ったマウント位置の検出修正**: 外部ボリュームが間違った場所にマウントされている場合を正しく検出
  * 問題: フラグファイルのみ存在し、外部ボリュームが`/Volumes/`に誤マウント時、「内部ストレージモード」と誤判定
  * 修正: `get_storage_mode()`でマウント状態を優先チェック、`external_wrong_location`モードを追加
- 🔧 **ストレージ切替の改善**:
  * `external_wrong_location`検出時、再マウント案内を表示
  * フラグファイルのみ存在する場合、削除オプションを提供
  * 実データなしの場合のエラーメッセージを改善
- 🎯 **一貫した判定ロジック**:
  * ストレージ切替UI: ボリューム名を渡して正確な判定
  * 個別ボリューム操作: マウント状態を先にチェック
  * バッチマウント: 外部ボリュームの状態を確認
- 📊 **新しいストレージモード**:
  * `external_wrong_location`: マウント位置異常（外部）- オレンジ色表示
  * 現在のマウント位置を明示的に表示
  * 再マウント推奨メッセージ

### v4.33.3 - Fixed Batch Mount Error Message for Locked Volumes
- 🔧 **バッチマウントエラーメッセージ修正**: 意図的な内蔵ストレージモードのボリュームに正しいメッセージを表示
  * 修正前: 「❌ マウント失敗: 内蔵ストレージにデータが存在します」
  * 修正後: 「⚠️ このボリュームはロックされています」
- 📊 **ロック中カウンター追加**: バッチマウント結果に「ロック中」の数を追加表示
  * 表示例: 「ℹ️  成功: 2 / 失敗: 0 / ロック中: 1」
  * ロックされたボリュームは失敗扱いにならず、情報としてカウント
- 🎯 **ストレージモード判定統合**: `get_storage_mode()` を使用して一貫した動作を保証
  * `internal_intentional`: ロックメッセージ表示、マウントスキップ
  * `internal_contaminated`: 汚染エラーメッセージ表示、マウントスキップ
  * それ以外: 通常のマウント処理を実行
- ✅ **個別操作との一貫性**: 個別ボリューム操作と同じ判定ロジックを使用

### v4.33.2 - Enhanced Storage Switch UI with Mode Detection
- 🎨 **ストレージ切替UI強化**: ストレージモードの明確な表示
  * 🔌 外部ストレージモード (青色)
  * 🏠 内部ストレージモード (緑色)
  * ⚠️  内蔵データ検出 (オレンジ色)
  * ⚠️ データ無し (グレー)
- 📊 **容量表示改善**: 各モードに応じた適切な容量情報表示
  * 外部/内部: 使用容量 + 残容量
  * 汚染: 内蔵ストレージ残容量のみ
  * データなし: N/A表示
- 🎯 **一目でわかるステータス**: アイコン、色、ラベルで視認性向上

### v4.33.1 - Fixed Individual Volume Control Storage Mode Detection
- 🔧 **個別ボリューム操作の修正**: フラグシステムを正しく使用するように修正
  * `get_storage_mode()` による判定で、意図的な内蔵か汚染かを区別
  * 意図的な内蔵: マウント拒否、切替案内メッセージ表示
  * 汚染データ: クリーンアップ方法の選択肢を提示

### v4.33.0 - Internal Storage Flag System for Contamination Detection
- 🚩 **内蔵ストレージフラグシステム**: 意図的な切替と意図しない汚染を識別
  * フラグファイル: `.playcover_internal_storage_flag`
  * 意図的切替時に自動作成、外部に戻す時に自動削除
  * フラグの有無で内蔵データの扱いを変える
- 🔒 **意図的な内蔵ストレージモード**:
  * フラグあり = 「🔒 内蔵ストレージモード」としてロック表示
  * マウント操作を拒否（切替機能で外部に戻すよう案内）
  * 誤ってマウントしてデータ競合を起こすことを防止
- ⚠️ **意図しない汚染データの検出**:
  * フラグなし = 「⚠️ 内蔵データ検出（未マウント）」として警告表示
  * マウント時に処理方法を確認（選択可能）
  * デフォルト: 外部優先（内蔵データ削除）← **推奨**
- 📋 **マウント時の処理選択**:
  ```
  1. 外部ボリュームを優先（内蔵データは削除）[推奨・デフォルト]
  2. 内部データを外部に統合（データを保持）
  3. キャンセル（マウントしない）
  ```
- 🎯 **使用シーン**:
  * PlayCover未マウント起動 → 内蔵に汚染データ作成 → 検出して適切に処理
  * ストレージ切替で内蔵に移動 → フラグ作成 → マウント誤操作を防止
  * 外部に戻す → フラグ削除 → 通常の外部ストレージモードに
- 🛡️ **データ保護**:
  * 意図的な内蔵モードでのマウント誤操作を完全に防止
  * 汚染データは確認なしに削除されず、ユーザーが選択可能
  * デフォルト選択で Enter押すだけで安全な処理

### v4.32.0 - Eye-Friendly Colors with Reduced Brightness & Saturation
- 👁️ **人間の色覚特性考慮**: 眩しさ軽減と視認性の両立
- 🎨 **全色を調整**: 明度・彩度を下げて目に優しい配色に変更
  * ソフトホワイト (WHITE) - #E6E6E6 (17.5:1) - 純白から調整、眩しさ大幅軽減
  * 明灰 (LIGHT_GRAY) - #B4B4B4 (9.8:1) - 標準テキスト用
  * 中灰 (GRAY) - #8C8C8C (5.8:1) - 補足情報用、視認性向上（従来より明るく）
  * 暗灰 (DIM_GRAY) - #6E6E6E (4.6:1) - 最小限のコントラスト
  * ソフト赤 (RED) - #FF7878 (9.5:1) - 彩度を抑えた赤
  * ソフト緑 (GREEN) - #78DC78 (11.8:1) - 眩しい緑から自然な緑へ
  * ソフト青 (BLUE) - #78B4F0 (10.2:1) - 柔らかい青
  * ソフト黄 (YELLOW) - #E6DC64 (14.5:1) - 眩しさ軽減
  * ソフトシアン (CYAN) - #64DCDC (12.2:1) - 彩度抑制
  * ソフトマゼンタ (MAGENTA) - #DC78DC (9.8:1) - 柔らかい紫
- 🔧 **DIM + GRAY重複削除**: 暗すぎる表示を修正
  * ボリューム情報の「未マウント」表示: `${DIM}${GRAY}` → `${GRAY}` 
  * アプリ一覧のバージョン表示: `${DIM}${GRAY}(v1.4.0)` → `${GRAY}(v1.4.0)`
  * Bundle ID表示: `${DIM}${GRAY}Bundle ID:` → `${GRAY}Bundle ID:`
  * 容量区切り: `${DIM}${GRAY}/` → `${GRAY}/`
- 🌿 **自然な拡張色**: 長時間使用でも目が疲れないナチュラルトーン
  * ナチュラルオレンジ #F0A064 (10.5:1)
  * ナチュラルゴールド #E6C864 (13.8:1)
  * ナチュラルライム #A0DC64 (12.5:1)
  * ナチュラルスカイ #78BEE6 (10.8:1)
  * ナチュラルターコイズ #64C8C8 (11.2:1)
  * ナチュラルバイオレット #C88CE6 (8.9:1)
  * ナチュラルピンク #E68CB4 (9.5:1)
  * ナチュラルライトグリーン #8CDC8C (12.8:1)
- ✅ **視認性向上**: 暗いグレー(#969696)を中灰(#8C8C8C)に変更し、背景との区別を明確化
- 😌 **長時間使用対応**: 眩しさを抑えつつ、必要な情報は明確に見える設計

### v4.31.0 - Optimized Color Scheme for RGB(28,28,28) Terminal Background
- 🎨 **ターミナル背景色最適化**: RGB(28,28,28) / #1C1C1C の暗背景に特化した配色設計
- ✅ **高コントラスト色**: WCAG AA基準 (4.5:1以上) を満たす色を選定
  * 純白 (WHITE) - #FFFFFF (21:1)
  * 明灰 (LIGHT_GRAY) - #C8C8C8 (12.6:1)
  * 明赤 (RED) - #FF6464 (8.2:1)
  * 明緑 (GREEN) - #64FF64 (14.7:1)
  * 明青 (BLUE) - #64B4FF (9.8:1)
  * 明黄 (YELLOW) - #FFFF64 (17.8:1)
  * 明シアン (CYAN) - #64FFFF (15.6:1)
  * 明マゼンタ (MAGENTA) - #FF64FF (10.9:1)
  * オレンジ (ORANGE) - #FFB450 (11.3:1)
  * ゴールド (GOLD) - #FFDC64 (16.2:1)
  * ライム (LIME) - #B4FF64 (15.1:1)
  * スカイブルー (SKY_BLUE) - #87CEFA (11.8:1)
  * ターコイズ (TURQUOISE) - #64E6DC (13.5:1)
  * バイオレット (VIOLET) - #DC8CFF (9.4:1)
  * ピンク (PINK) - #FF8CC8 (10.1:1)
  * ライトグリーン (LIGHT_GREEN) - #96FF96 (15.3:1)
- 🎯 **ANSIスタイル追加**: 太字、下線、取り消し線などのスタイル定数を追加
  * BOLD - 太字 (重要な要素を強調)
  * UNDERLINE - 下線 (見出しを強調)
  * STRIKETHROUGH - 取り消し線 (削除されたアイテム)
  * DIM - 薄暗く (補足情報)
- ✨ **print関数強化**: 新しいprint関数を追加
  * `print_highlight()` - ハイライト表示（太字黄色）
  * `print_dim()` - 薄暗く表示（補足情報用）
  * `print_bold()` - 太字表示（重要テキスト）
  * `print_underline()` - 下線付き表示（見出し用）
  * `get_container_size_styled()` - 数値を太字、単位を通常体で表示
- 🎨 **UI表示改善**:
  * アプリ名: 太字白色で強調
  * パス/Bundle ID: 薄暗くグレーで補足情報として表示
  * 容量表示: 数値を太字、単位を通常体
  * ステータス: 薄暗くグレーで表示
  * メニュー項目: 番号を太字色分けで強調
  * ロック中: 太字ゴールドで目立たせる
- 📐 **レイアウト強化**:
  * セクション見出し: 太字 + 下線
  * 操作方向: 矢印(→)と色分けで視覚化（内部→外部）
  * 警告枠: 目立つ枠線で囲む（容量不足警告）
  * アプリ管理ヘッダー: 装飾的な罫線でセクション区切り
- 👁️ **視認性向上**: 情報の階層構造が一目で分かるデザイン

### v4.30.0 - Enhanced Color Scheme with 16 Recommended Colors
- 🎨 **カラースキームの完全刷新**: 推奨16色（暗背景用）を採用
- ✅ ANSI明色コード（90-97）とRGB拡張色を併用
- ✅ 新しいカラー定義:
  * 白 (WHITE) - #FFFFFF
  * 明灰 (LIGHT_GRAY) - #BFBFBF
  * 赤 (RED) - #FF4040
  * 緑 (GREEN) - #00FF00
  * 青 (BLUE) - #4080FF
  * 黄 (YELLOW) - #FFFF00
  * マゼンタ (MAGENTA) - #FF00FF
  * シアン (CYAN) - #00FFFF
  * オレンジ (ORANGE) - #FFA500
  * ライムグリーン (LIME) - #AFFF00
  * ターコイズ (TURQUOISE) - #40E0D0
  * ピンク (PINK) - #FF69B4
  * ゴールド (GOLD) - #FFD700
  * スカイブルー (SKY_BLUE) - #87CEFA
  * バイオレット (VIOLET) - #EE82EE
  * ライトグリーン (LIGHT_GREEN) - #98FB98
- 🎨 色の使い分けを最適化:
  * 見出し/ヘッダー: CYAN
  * 成功メッセージ: GREEN
  * エラーメッセージ: RED
  * 警告メッセージ: ORANGE
  * 情報メッセージ: SKY_BLUE
  * 強調/重要: GOLD
  * 進行中: VIOLET
  * メニュー項目番号: LIGHT_GREEN
  * 戻る/終了(0番): WHITE
- ✅ 全メニュー項目の色をLIGHT_GREENに統一
- ✅ ロック表示をGOLDで強調
- 👀 暗い背景でも見やすい高輝度色を使用

### v4.29.0 - App Management UI and Emoji Consistency
- 🎨 **アプリ管理UI改善**: インストール済みアプリリストの表示形式を改善
- ✅ リスト表示: 「・ 🔌 7.0M (v3.6.0) 崩壊：スターレイル」→「位置: 🔌 外部 | 7.0M (v3.6.0) 崩壊：スターレイル」
- ✅ ストレージアイコンにラベル追加: 「🔌」→「🔌 外部」、「🏠」→「🏠 内部」
- ✅ メニュー表示改善: セパレータを追加し、ラベルを簡素化
- 🎨 **絵文字の一貫性向上**: 白黒絵文字をカラー絵文字に統一
- ✅ `print_success()`: 「✓」→「✅」
- ✅ `print_error()`: 「✗」→「❌」
- ✅ `print_warning()`: 「⚠」→「⚠️」
- ✅ `print_info()`: 「ℹ」→「ℹ️」
- ✅ 個別メッセージ内の絵文字もすべて統一
- 👀 ビジュアル一貫性: 全体で統一感のあるUIに

### v4.28.0 - UI Improvements and Capacity Checks
- 🎨 **UI改善**: ボリューム情報とストレージ切替のUIを再設計
- ✅ 個別ボリューム操作: 「個別ボリューム操作」→「ボリューム情報」に変更
- ✅ 個別ボリューム操作: 「登録されているボリューム」→「登録ボリューム」に変更
- 🔒 **内蔵ストレージモードのロック表示追加**: 内蔵ストレージにデータがある場合もロック表示
  - 例: 「🔒ロック中 ゼンレスゾーンゼロ | 🏠内蔵ストレージにデータ有」
- 🎨 ストレージ切替: 「ストレージ切り替え（内蔵⇄外部）」→「ストレージ切替（内蔵⇄外部）」に変更
- 🎨 ストレージ切替: 「データステータス」→「データ位置情報」に変更
- ✅ ストレージ切替: アプリ一覧に残容量表示を追加
- 🛡️ **容量チェック機能追加**: ストレージ切替前に容量を確認
- ⚠️ 容量不足時に警告表示（10%安全余裕考慮）
- 📊 新しいユーティリティ関数追加:
  - `get_container_size_bytes()`: コンテナサイズをバイト単位で取得
  - `get_storage_free_space_bytes()`: 空き容量をバイト単位で取得

### v4.27.0 - Pure zsh Syntax (Removed bash Compatibility)
- 🔧 **純粋なzsh構文に書き直し**: bash互換機能を完全削除
- ✅ `setopt KSH_ARRAYS` を削除
- ✅ 配列構文を変換: `${#array[@]}` → `${#array}`
- ✅ 配列インデックスを1-basedに変換
- ✅ C-style forループをzsh構文に変換
- ✅ `for ... in "${array[@]}"` → `for ... in "${(@)array}"`
- ✅ 前提条件・環境・注意点セクションを追加
- ✅ スクリプト末尾に明示的な `exit 0` を追加
- ✅ 29箇所の配列長構文、5箇所のforループ、13箇所のfor-in構文を変換
- ✅ より純粋でネイティブなzshスクリプトに進化

### v4.26.3 - Fix rsync Compatibility for macOS
- 🐛 **rsync互換性修正**: macOS標準rsyncに対応
- ✅ `--info=progress2` → `--progress` に変更
- ✅ macOS標準rsync (古いバージョン) をサポート
- ✅ コンテナコピー処理の安定化

### v4.26.2 - Fix Homebrew Path Detection for Apple Silicon
- 🐛 **Homebrewパス検出修正**: Apple Silicon/Intel両対応に
- ✅ Apple Silicon: `/opt/homebrew/bin/brew`
- ✅ Intel: `/usr/local/bin/brew`
- ✅ 自動検出して `BREW_PATH` 定数に設定
- ✅ すべてのbrewコマンドを `$BREW_PATH` に統一
- ✅ install_homebrew関数も動的パス対応

### v4.26.1 - Fix PlayCover Installation Verification
- 🐛 **インストール検証修正**: PlayCoverインストール後の確認処理を追加
- ✅ `brew install` 成功確認
- ✅ `/Applications/PlayCover.app` 存在確認（最大10秒待機）
- ✅ インストール失敗時の詳細エラーメッセージ
- ✅ ログファイル表示による問題診断支援

### v4.26.0 - Simplify Nuclear Cleanup with Mapping-Based Approach
- 🧹 **超強力クリーンアップの簡素化**: マッピングファイルベースの処理に変更
- ✅ 削除対象: 7項目 → 4項目に整理
- ✅ 処理手順の最適化:
  1. マップ登録ボリューム全アンマウント
  2. マップ登録ボリューム全削除
  3. PlayCoverのアンインストール
  4. マップ登録コンテナ（内蔵）を削除
  5. マッピングファイル削除
- ✅ 不要な処理を削除（PlayTools.framework、キャッシュなど）
- ✅ より高速でシンプルな完全リセット

### v4.25.0 - Fix Initial Setup with Proper Container Initialization
- 🎯 **初期セットアップフロー修正**: PlayCoverコンテナの正しい初期化手順を実装
- ✅ PlayCoverインストール後、一度起動してコンテナを作成
- ✅ 作成された完全なコンテナを外部ストレージにコピー
- ✅ 設定ファイル、フレームワーク、キャッシュが正しく配置される
- ✅ 超強力クリーンアップでPlayCoverを正しくアンインストール（`brew uninstall --cask playcover-community`）
- ✅ 削除プレビューにPlayCoverアプリを追加（7項目に拡張）
- ✅ 初期セットアップの実行順序を最適化（ソフトウェアインストール → ボリューム作成）

### v4.24.2 - Fix Volume Detection Pattern
- 🐛 **ボリューム検出パターン修正**: 2段階grepアプローチで柔軟な検出
- ✅ `diskutil list` 出力の異なるフォーマットに対応
- ✅ `volume_exists()` と `get_volume_device()` を改善

### v4.24.1 - Fix Environment Check
- 🐛 **環境チェック修正**: 初期セットアップ後の環境検証失敗を修正
- ✅ `diskutil info` → `volume_exists()` に変更
- ✅ ボリュームの存在チェックを正しく実装
- ✅ マウント状態に関係なくボリュームを検出

### v4.24.0 - Exit After Nuclear Cleanup
- 🚪 **終了動作変更**: クリーンアップ完了後にターミナルを閉じる
- ✅ メインメニューに戻らず、再セットアップを促す
- ✅ 3秒後に自動的にターミナルを閉じる
- ✅ 次のステップを明確に表示（初期セットアップが必要）

### v4.23.1 - Fix Zsh Reserved Variable
- 🐛 **変数名競合修正**: zsh予約変数 `path` との競合を解決
- ✅ `path` → `container_path`, `item_path`, `target_path` に変更
- ✅ "inconsistent type for assignment" エラーを修正

### v4.23.0 - Complete External Command Path Fix
- 🔧 **全外部コマンドパス修正**: 18種類のコマンドをフルパス指定
- ✅ macOS環境でのPATH制限問題を完全解決（110+箇所）

### v4.22.0 - Deletion Preview
- 📋 **削除プレビュー機能**: 実行前に削除対象を完全表示
- ✅ 2フェーズアプローチ（スキャン → 確認 → 実行）
- ✅ 削除対象の詳細情報を6カテゴリに分けて表示
- ✅ より安全で透明性の高いクリーンアップ

### v4.21.1 - Critical Safety Fix
- 🔒 **重大なセキュリティ修正**: システムボリューム削除を防止
- ✅ Macintosh HD、Data等のシステムボリュームを明示的にスキップ
- ✅ マッピングファイル優先の安全なボリューム削除

### v4.21.0 - Nuclear Cleanup Feature
- 🔥 超強力クリーンアップ（完全リセット）機能追加
- ✅ すべてのボリューム・コンテナの完全削除
- ✅ PlayTools.frameworkの削除
- ✅ キャッシュ・設定・ログの完全クリア
- ✅ 二重確認システム（yes + DELETE ALL）

詳細な更新履歴は `CHANGELOG.md` を参照してください。

---

## 📚 関連ドキュメント

### ユーザー向け
- `docs/guides/NUCLEAR_CLEANUP_GUIDE.md` - 🔥 超強力クリーンアップ詳細ガイド
- `docs/guides/USER_DIAGNOSTIC_GUIDE.md` - トラブルシューティングガイド
- `docs/guides/USAGE.md` - 詳細な使用方法

### 開発者向け
- `CHANGELOG.md` - 詳細な更新履歴
- `docs/development/` - 実装ドキュメント
- `docs/archive/` - 過去のバグ修正履歴

---

## 📝 ライセンス

このプロジェクトは個人利用および学習目的で作成されました。

---

## 🙏 謝辞

- PlayCover Community
- macOS コミュニティ
- すべてのコントリビューター

---

**最終更新:** 2025年10月27日（macOS Sequoia 15.1対応、v4.30.0）
