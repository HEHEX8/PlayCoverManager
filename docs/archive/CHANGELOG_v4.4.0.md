# PlayCover Complete Manager v4.4.0 変更ログ

## リリース日: 2025-10-25

## 🎯 主要な機能追加: 全アプリ一括アンインストール

### 背景
v4.3.2では、アプリを1つずつアンインストールする機能が提供されていました。ユーザーからの要望により、**PlayCoverを含むすべてのアプリを一度に削除する機能**を追加しました。

### 実装した機能

#### 1. 全アプリ一括アンインストール機能

**メニュー構成の変更:**
```
【変更前 v4.3.2】
【アプリ管理】
  1. アプリをインストール
  2. アプリをアンインストール

【変更後 v4.4.0】
【アプリ管理】
  1. アプリをインストール
  2. アプリをアンインストール
  3. 全アプリを一括アンインストール  ← NEW!
```

**機能概要:**
- すべてのインストール済みアプリを一括削除
- PlayCoverボリュームも含めて完全削除
- マッピングファイルの完全クリア
- 進捗表示とサマリーレポート

#### 2. 一括削除のフロー

**ステップ1: アプリ一覧表示**
```
以下のアプリをすべて削除します:

  1. 原神
     Bundle ID: com.miHoYo.GenshinImpact
     ボリューム: GenshinImpact-volume

  2. 崩壊：スターレイル
     Bundle ID: com.HoYoverse.hkrpgoversea
     ボリューム: Honkai-StarRail-volume

  3. PlayCover
     Bundle ID: io.playcover.PlayCover
     ボリューム: PlayCover

合計: 3 個のアプリ
```

**ステップ2: 警告表示**
```
⚠ この操作は以下を実行します:
  1. すべてのアプリを PlayCover から削除
  2. すべての設定ファイルを削除
  3. すべての Entitlements を削除
  4. すべての Keymapping を削除
  5. すべての Containersフォルダを削除
  6. すべての APFSボリュームをアンマウント・削除
  7. すべてのマッピング情報を削除

❌ この操作は取り消せません！
❌ PlayCoverを含むすべてのアプリが削除されます！

本当にすべてのアプリをアンインストールしますか？ (yes/NO): 
```

**ステップ3: バッチ削除実行**
```
ℹ 一括アンインストールを開始します...

ℹ [1/3] 原神 を削除中...
✓ 原神

ℹ [2/3] 崩壊：スターレイル を削除中...
✓ 崩壊：スターレイル

ℹ [3/3] PlayCover を削除中...
✓ PlayCover

ℹ マッピング情報をクリア中...
✓ マッピング情報をクリアしました
```

**ステップ4: サマリー表示**
```
═══════════════════════════════════════════════════════════

✓ 一括アンインストールが完了しました

  ✓ 成功: 3 個

Enterキーでメニューに戻る...
```

#### 3. 処理の詳細

**各アプリに対する削除処理:**
```bash
for each app in all_apps:
    # 1. Applications/ から削除
    rm -rf "${PLAYCOVER_CONTAINER}/Applications/${bundle_id}.app"
    
    # 2. App Settings/ から削除
    rm -f "${PLAYCOVER_CONTAINER}/App Settings/${bundle_id}.plist"
    
    # 3. Entitlements/ から削除
    rm -f "${PLAYCOVER_CONTAINER}/Entitlements/${bundle_id}.plist"
    
    # 4. Keymapping/ から削除
    rm -f "${PLAYCOVER_CONTAINER}/Keymapping/${bundle_id}.plist"
    
    # 5. Containers/ から削除
    rm -rf "~/Library/Containers/${bundle_id}/"
    
    # 6. ボリュームをアンマウント
    diskutil unmount "${PLAYCOVER_CONTAINER}/${volume_name}"
    
    # 7. ボリュームを削除
    diskutil apfs deleteVolume ${volume_device}
```

**最後の処理:**
```bash
# 8. マッピングファイルを完全クリア
> playcover-map.txt  # ファイルを空にする
```

### コード変更箇所

**ファイル**: `playcover-complete-manager.command`

1. **メインメニュー表示の変更** (lines 2236-2248)
   ```bash
   echo "  3. 全アプリを一括アンインストール"
   echo -n "${CYAN}選択 (0-10):${NC} "  # 9 → 10 に変更
   ```

2. **uninstall_all_apps() 関数の追加** (lines 2660-2859)
   ```bash
   uninstall_all_apps() {
       # アプリ一覧表示
       # 確認プロンプト
       # バッチ削除処理
       # マッピングファイルクリア
       # サマリー表示
   }
   ```

3. **メインループの更新** (lines 3477-3516)
   ```bash
   case "$choice" in
       3) uninstall_all_apps ;;  # 新規追加
       4) mount_all_volumes ;;   # 3 → 4 にシフト
       ...
       10) show_mapping_info ;;  # 9 → 10 にシフト
   ```

### 使用シーン

#### シーン1: 環境完全リセット
```
ユーザー: 「すべてのアプリをアンインストールして環境をリセットしたい」
→ メインメニュー → 3. 全アプリを一括アンインストール
→ 全アプリ一覧を確認
→ yes で確認
→ すべてのアプリが削除される
→ マッピングファイルがクリアされる
```

#### シーン2: クリーンインストール前の準備
```
ユーザー: 「PlayCover環境を一からやり直したい」
→ 全アプリ一括アンインストール
→ すべて削除完了
→ 新規アプリのインストール
→ クリーンな環境でスタート
```

#### シーン3: ディスク容量の大量解放
```
ユーザー: 「大量のゲームアプリを削除して容量を確保したい」
→ 全アプリ一括アンインストール
→ 1度の操作ですべてのアプリ + ボリュームが削除
→ 大量の容量が解放される
```

### バージョン更新内容

```
v4.3.2 → v4.4.0
- 行数: 3328行 → 3527行 (+199行)
- サイズ: 121KB → 128KB (+7KB)
- 新規関数: uninstall_all_apps()
- メニュー項目: 9個 → 10個
```

### 特徴と利点

**特徴:**
- ✅ PlayCoverボリューム保護は無視（全削除のため）
- ✅ 各アプリの削除進捗を表示
- ✅ 成功/失敗のカウント
- ✅ マッピングファイルの完全クリア
- ✅ 二重確認（yes入力必須）

**利点:**
- ✅ 複数アプリを1度に削除可能
- ✅ 手動で1つずつ削除する手間が不要
- ✅ 環境の完全リセットが簡単
- ✅ PlayCover保護を気にせず全削除

**注意点:**
- ⚠️ 取り消し不可
- ⚠️ PlayCoverを含むすべてが削除される
- ⚠️ バックアップは事前に実施が必要

### v4.3.2との違い

| 項目 | v4.3.2 (個別削除) | v4.4.0 (一括削除) |
|------|------------------|------------------|
| 削除方法 | 1個ずつ選択 | 全アプリを一括 |
| PlayCover保護 | あり（最後まで削除不可） | なし（全削除のため） |
| 確認回数 | 各アプリごと | 1回のみ |
| 進捗表示 | なし | [n/total] 形式 |
| サマリー | なし | 成功/失敗カウント |
| マッピング | 個別削除 | 完全クリア |

### 次回以降の改善案

1. **選択的一括削除**
   - チェックボックスで削除するアプリを選択
   - PlayCover以外を一括削除

2. **削除前の自動バックアップ**
   - 一括削除前に自動でバックアップ作成

3. **削除シミュレーション**
   - 実際に削除せずに、何が削除されるかプレビュー

---

## まとめ

v4.4.0では、待望の**全アプリ一括アンインストール機能**を追加しました。

**主な追加機能:**
- 【一括削除】PlayCoverを含むすべてのアプリを1度に削除
- 【進捗表示】各アプリの削除状況をリアルタイム表示
- 【サマリー】成功/失敗のカウントを表示
- 【完全クリア】マッピングファイルを完全にクリア

**使用例:**
```
メインメニュー → 3. 全アプリを一括アンインストール
→ アプリ一覧確認
→ yes で確認
→ すべて削除完了
→ 環境完全リセット
```

**推奨**: すべてのユーザーは v4.4.0 へのアップグレードを推奨します。環境のリセットやクリーンインストールがより簡単になります。
