# PlayCover Complete Manager v4.4.1 変更ログ

## リリース日: 2025-10-25

## 🎯 主要な改善: 統合アンインストールメニュー（個別 + 一括）

### 背景
v4.4.0では、「全アプリ一括アンインストール」をメインメニューの独立した選択肢として実装していました。しかし、ユーザーからのフィードバックにより：
- メインメニューが煩雑になる
- 個別削除と一括削除が混同される可能性

これらの問題を解決するため、**1つのアンインストールメニュー内で個別/一括を選択できる統合UI**に変更しました。

### 実装した改善

#### 1. メニュー構造の簡素化

**変更前 (v4.4.0):**
```
▼ メインメニュー
【アプリ管理】
  1. アプリをインストール
  2. アプリをアンインストール          ← 個別削除のみ
  3. 全アプリを一括アンインストール    ← 独立した選択肢

（メニュー項目: 0-10、計11個）
```

**変更後 (v4.4.1):**
```
▼ メインメニュー
【アプリ管理】
  1. アプリをインストール
  2. アプリをアンインストール          ← 個別 + 一括の統合メニュー

（メニュー項目: 0-9、計10個）
```

**メリット:**
- ✅ メインメニューがすっきり
- ✅ アンインストール機能が1箇所に集約
- ✅ より直感的なUI

#### 2. 統合アンインストールUIの設計

**新しいフロー:**
```
メインメニュー → 2. アプリをアンインストール
↓
アプリ一覧表示:
  1. 原神
     Bundle ID: com.miHoYo.GenshinImpact
     ボリューム: GenshinImpact-volume

  2. 崩壊：スターレイル
     Bundle ID: com.HoYoverse.hkrpgoversea
     ボリューム: Honkai-StarRail-volume

  3. PlayCover
     Bundle ID: io.playcover.PlayCover
     ボリューム: PlayCover

───────────────────────────────────────────────────

▼ アンインストール方法を選択

  個別削除: 1-3 の番号を入力
  一括削除: ALL を入力（すべてのアプリを一度に削除）
  キャンセル: 0 を入力

選択: 
```

**選択肢の視覚的分離:**
- 🟢 **個別削除**: 緑色で表示、番号入力
- 🔴 **一括削除**: 赤色で表示、"ALL" 入力
- 🔵 **キャンセル**: シアン色で表示、0 入力

#### 3. 入力による動作の分岐

**入力パターン:**

| 入力 | 動作 | 説明 |
|------|------|------|
| `1`, `2`, `3`... | 個別削除 | 指定した番号のアプリを削除 |
| `ALL` または `all` | 一括削除 | すべてのアプリを一度に削除 |
| `0` | キャンセル | メインメニューに戻る |
| その他 | エラー | 無効な選択として再表示 |

**実装:**
```bash
read app_choice

# Check for batch uninstall
if [[ "$app_choice" == "ALL" ]] || [[ "$app_choice" == "all" ]]; then
    uninstall_all_apps
    return
fi

# Individual uninstall
if [[ "$app_choice" =~ ^[0-9]+$ ]] && [[ $app_choice -ge 1 ]] && [[ $app_choice -le $total_apps ]]; then
    # Delete selected app
fi
```

#### 4. UIの改善点

**混同防止のデザイン:**

1. **色分け:**
   ```bash
   ${GREEN}個別削除${NC}  ← 緑色（安全）
   ${RED}一括削除${NC}    ← 赤色（危険）
   ${CYAN}キャンセル${NC}  ← シアン色（中立）
   ```

2. **明確な説明:**
   ```
   個別削除: 1-3 の番号を入力           ← 具体的な範囲
   一括削除: ALL を入力（説明付き）      ← 特殊キーワード + 説明
   ```

3. **セパレーター:**
   ```
   ─────────────────────────────────
   ▼ アンインストール方法を選択        ← 明確な区切り
   ```

### コード変更箇所

**ファイル**: `playcover-complete-manager.command`

1. **メインメニューの変更** (lines 2236-2248)
   ```bash
   # 削除: 3. 全アプリを一括アンインストール
   # 項目数: 0-10 → 0-9 に戻す
   ```

2. **uninstall_workflow() の拡張** (lines 2411-2440)
   ```bash
   # 新しい選択UI
   echo "▼ アンインストール方法を選択"
   echo "  個別削除: 1-${total_apps} の番号を入力"
   echo "  一括削除: ALL を入力（すべてのアプリを一度に削除）"
   echo "  キャンセル: 0 を入力"
   
   read app_choice
   
   # Branch logic
   if [[ "$app_choice" == "ALL" ]] || [[ "$app_choice" == "all" ]]; then
       uninstall_all_apps
       return
   fi
   ```

3. **メインループの簡素化** (lines 3492-3529)
   ```bash
   case "$choice" in
       2) uninstall_workflow ;;  # 個別 + 一括の統合
       # 3) uninstall_all_apps の行を削除
       3) mount_all_volumes ;;   # 4 → 3 に戻す
       ...
   ```

### バージョン更新内容

```
v4.4.0 → v4.4.1
- 行数: 3527行 → 3536行 (+9行)
- サイズ: 128KB → 129KB (+1KB)
- メニュー項目: 0-10 → 0-9 (簡素化)
- UI改善: 統合アンインストールメニュー
```

### 使用例

#### 例1: 個別削除
```
メインメニュー → 2. アプリをアンインストール
→ アプリ一覧表示
→ 選択: 1  （原神を選択）
→ 確認: yes
→ 原神が削除される
```

#### 例2: 一括削除
```
メインメニュー → 2. アプリをアンインストール
→ アプリ一覧表示
→ 選択: ALL  （大文字でも小文字でもOK）
→ 確認: yes
→ すべてのアプリが削除される
```

#### 例3: キャンセル
```
メインメニュー → 2. アプリをアンインストール
→ アプリ一覧表示
→ 選択: 0
→ メインメニューに戻る
```

### 比較表

| 項目 | v4.4.0 | v4.4.1 |
|------|--------|--------|
| メインメニュー項目数 | 11個 (0-10) | 10個 (0-9) |
| 個別削除の場所 | 選択肢2 | 選択肢2内 |
| 一括削除の場所 | 選択肢3（独立） | 選択肢2内 |
| 一括削除の起動方法 | メニュー選択 | "ALL" 入力 |
| UI階層 | フラット | 統合型 |
| 混同リスク | あり | 低減 |

### ユーザーへの影響

**ポジティブな影響:**
- ✅ メインメニューがシンプルに
- ✅ アンインストール機能が見つけやすい
- ✅ 個別/一括の切り替えが明確
- ✅ 色分けで視覚的に区別しやすい

**注意事項:**
- ⚠️ "ALL" という特殊キーワードを入力する必要がある
- ⚠️ 大文字でも小文字でも受け付ける

### 次回以降の改善案

1. **プレビューモード**
   - "ALL" 入力時に、削除されるアプリ一覧を再確認

2. **ショートカット**
   - "a" でも一括削除を起動

3. **カラースキーム設定**
   - ユーザーが色をカスタマイズ可能に

---

## まとめ

v4.4.1では、v4.4.0で追加した一括アンインストール機能を、より使いやすいUIに改善しました。

**主な改善点:**
- 【統合UI】個別削除と一括削除を1つのメニューに統合
- 【簡素化】メインメニュー項目を11個→10個に削減
- 【明確化】色分けと説明文で混同を防止
- 【柔軟性】"ALL"または"all"で一括削除を起動

**使い方:**
```
アンインストールメニュー内で：
  - 番号入力 → 個別削除
  - ALL入力 → 一括削除
  - 0入力   → キャンセル
```

**推奨**: v4.4.0をお使いの方は v4.4.1 へのアップグレードを推奨します。より直感的で使いやすいUIになっています。
