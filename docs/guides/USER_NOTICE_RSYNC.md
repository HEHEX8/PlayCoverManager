# ユーザー様への重要なお知らせ

## rsync エラーについて

### エラーメッセージ
以下のようなエラーが表示された場合の対処方法です：

```
rsync: unrecognized option `--info=progress2'
rsync error: syntax or usage error (code 1) at main.c(1333) [client=2.6.9]
```

---

## 現在の状況

### ✅ 良いニュース

1. **スクリプトのコードは既に修正済み**
   - 最新版（v1.5.1以降）では `--progress` を使用
   - macOS 標準の rsync 2.6.9 と互換性あり
   - 問題なく動作します

2. **フェイルセーフが正常に機能**
   - エラーが発生してもデータは保護されています
   - バックアップが自動的に復元されます
   - データ損失のリスクはありません

### 📝 確認事項

エラーが発生した場合、以下の確認をお願いします：

```bash
# スクリプトの rsync コマンドを確認
grep -n "rsync.*--info=progress2" 2_playcover-volume-manager.command
```

#### 結果A: 何も表示されない場合
```
# 出力なし
```
→ **最新版を使用中です**。エラーは発生しないはずです。

#### 結果B: 行番号が表示される場合
```
1110:   rsync -aH --info=progress2 ...
1239:   rsync -aH --info=progress2 ...
```
→ **古いバージョンを使用中です**。最新版への更新が必要です。

---

## 対処方法

### 方法1: スクリプトを最新版に更新（推奨）

最新のスクリプトファイルをダウンロードして置き換えてください。

**確認方法**:
```bash
# 正しいバージョンの確認
grep -n "rsync.*--progress" 2_playcover-volume-manager.command

# 期待される出力:
# 1110:   if sudo /usr/bin/rsync -avH --progress ...
# 1239:   if sudo /usr/bin/rsync -avH --progress ...
```

### 方法2: 手動で修正（上級ユーザー向け）

スクリプトを編集して以下の置換を行います：

```bash
# 変更前
rsync -aH --info=progress2

# 変更後
rsync -avH --progress
```

**置換箇所**:
- Line 1110 付近（内蔵 → 外部）
- Line 1239 付近（外部 → 内蔵）

### 方法3: Homebrew の rsync を使用（オプション）

より新しいバージョンの rsync をインストールすることもできます：

```bash
# Homebrew で rsync をインストール
brew install rsync

# バージョン確認
/opt/homebrew/bin/rsync --version
# rsync version 3.2.7 protocol version 31

# この場合、スクリプトで /opt/homebrew/bin/rsync を使用すれば
# --info=progress2 オプションも使用可能です
```

---

## 進捗表示の違い

### macOS 標準 rsync (`--progress`)

```
Documents/file1.txt
     102,400 100%   10.42MB/s    0:00:00
Documents/file2.txt
   5,242,880 100%   52.43MB/s    0:00:00
Documents/file3.txt
  10,485,760 100%  104.86MB/s    0:00:00
...
```

**特徴**:
- ファイルごとに進捗を表示
- ファイル数が多いと出力が長くなる
- しかし、確実に動作する ✅

### Homebrew rsync (`--info=progress2`)

```
   933,009,045 100%  156.50MB/s    0:00:05
```

**特徴**:
- 全体の進捗を1行で表示
- よりクリーンな出力
- rsync 3.1.0+ が必要（macOS 標準では使えない）

---

## フェイルセーフについて

エラーが発生した場合でも、以下の保護機能が働きます：

```
ℹ データをコピー中... (しばらくお待ちください)

rsync: unrecognized option `--info=progress2'
rsync error: syntax or usage error (code 1)

✗ データのコピーに失敗しました
ℹ バックアップを復元中...
✓ バックアップを復元しました

メインメニューに戻ります...
```

### 保護されていること

1. **データは失われません**
   - 自動バックアップが作成されています
   - エラー時に自動復元されます

2. **元の状態に戻ります**
   - ストレージの場所は変更されません
   - データの整合性が保たれます

3. **安全に再試行できます**
   - 最新版に更新してから再実行できます
   - 何度試行してもデータは安全です

---

## よくある質問

### Q1: なぜこのエラーが発生するのですか？

**A**: macOS に標準でインストールされている rsync は古いバージョン（2.6.9）で、`--info=progress2` オプションに対応していないためです。このオプションは rsync 3.1.0 以降で追加された機能です。

### Q2: データは失われましたか？

**A**: いいえ、失われていません。フェイルセーフ機能により、エラー発生時に自動的にバックアップが復元されます。

### Q3: 最新版ではなぜ問題が起きないのですか？

**A**: 最新版では macOS 標準の rsync と互換性のある `--progress` オプションを使用しているため、問題なく動作します。

### Q4: 手動で修正する必要がありますか？

**A**: いいえ、最新版のスクリプトをダウンロードすれば自動的に修正されます。

---

## まとめ

### ✅ 安心してください

1. **コードは既に修正済み** - 最新版では問題なく動作します
2. **データは保護されています** - フェイルセーフが正常に機能しています
3. **簡単に解決できます** - 最新版に更新するだけです

### 📞 サポート

問題が解決しない場合や、ご質問がある場合は、以下の情報を添えてお問い合わせください：

1. スクリプトのバージョン確認結果
2. エラーメッセージ全文
3. macOS のバージョン
4. rsync のバージョン (`rsync --version`)

---

**最終更新**: 2025-01-XX  
**対応バージョン**: v1.5.2 以降
