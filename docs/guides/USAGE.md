# PlayCover 外部ストレージ管理 - 使用ガイド

## クイックスタート

### 🚀 初めて使用する場合

1. **初期セットアップを実行**
   ```bash
   ./0_playcover-initial-setup.command
   ```
   または Finder でダブルクリック

2. **IPAをインストール**
   ```bash
   ./1_playcover-ipa-install.command
   ```
   または Finder でダブルクリック

---

## 📋 詳細ガイド

### ステップ1: 初期セットアップ

**ファイル**: `0_playcover-initial-setup.command`

**目的**: PlayCover本体を外部ストレージに配置

**前提条件**:
- ✅ Apple Silicon Mac
- ✅ macOS Tahoe 26.0.1以降
- ✅ 外部ストレージ接続済み (USB/Thunderbolt)
- ✅ フルディスクアクセス権限付与済み

**処理内容**:
1. システム要件確認
2. 管理者パスワード入力
3. 外部ストレージ選択
4. PlayCover ボリューム作成
5. データ移行（既存データがある場合）
6. マウント設定
7. 必要に応じてソフトウェアインストール

**所要時間**: 5-15分（初回のみ）

---

### ステップ2: IPAインストール

**ファイル**: `1_playcover-ipa-install.command`

**目的**: 各アプリを専用の外部ストレージボリュームにインストール

**前提条件**:
- ✅ 初期セットアップ完了済み
- ✅ インストールしたいIPAファイル準備済み
- ✅ フルディスクアクセス権限付与済み

**処理内容**:
1. PlayCover 環境確認
2. 管理者パスワード入力
3. IPA ファイル選択（GUIダイアログ）
4. アプリ情報自動抽出
   - Bundle ID
   - アプリ名
5. 専用ボリューム作成
6. データ競合処理（既存データがある場合）
7. マウント設定
8. PlayCover にインストール要求

**所要時間**: 3-10分（アプリごと）

---

## 🔧 トラブルシューティング

### セキュリティ警告が表示される

**問題**:
```
Appleは、"*.command"にMacに損害を与えたり、
プライバシーを侵害する可能性のあるマルウェアが含まれていないことを検証できませんでした。
```

**解決方法**:
1. ファイルを**右クリック**
2. **「開く」**を選択
3. 確認ダイアログで**「開く」**をクリック

または:
```bash
xattr -d com.apple.quarantine *.command
```

---

### フルディスクアクセス権限がない

**問題**:
```
✗ フルディスクアクセス権限が必要です
```

**解決方法**:
1. システム設定を開く
2. プライバシーとセキュリティ > フルディスクアクセス
3. ターミナル.app を追加
4. スクリプトを再実行

---

### PlayCover が見つからない

**問題**:
```
✗ PlayCover がインストールされていません
```

**解決方法**:
初期セットアップスクリプトを実行してください。自動でインストールされます。

---

### ボリュームのマウントに失敗

**問題**:
```
✗ ボリュームのマウントに失敗しました
```

**解決方法**:
1. ディスクユーティリティを開く
2. 外部ドライブを選択
3. First Aid を実行
4. スクリプトを再実行

---

## 📊 マッピングファイル

### 場所
```
playcover-map.txt（スクリプトと同じディレクトリ）
```

### 形式
```
VolumeName[TAB]BundleID
```

### 例
```
PlayCover	io.playcover.PlayCover
GenshinImpact	com.miHoYo.GenshinImpact
HonkaiStarRail	com.HoYoverse.HonkaiStarRail
```

### 用途
- ボリュームとアプリの対応関係を記録
- 複数アプリの一括管理
- 将来の拡張機能で使用予定

---

## 🎯 ベストプラクティス

### ストレージ選択
- ✅ USB 3.0以上を推奨
- ✅ Thunderbolt/USB4 が最適
- ✅ SSD推奨（HDD非推奨）
- ✅ 十分な空き容量確保（アプリ1つあたり10-50GB）

### データ管理
- ✅ 初回実行時は必ず内部データをバックアップ
- ✅ 外部ストレージは常時接続推奨
- ✅ 定期的なバックアップ推奨

### セキュリティ
- ✅ スクリプトのソースコードを確認可能
- ✅ 管理者権限は必要最小限で使用
- ✅ フルディスクアクセスは必須

---

## 🔄 アンインストール方法

### アプリ個別のアンインストール

1. PlayCover からアプリを削除
2. ボリュームをアンマウント:
   ```bash
   diskutil unmount force /Volumes/[AppVolumeName]
   ```
3. ボリュームを削除:
   ```bash
   sudo diskutil apfs deleteVolume /dev/disk[X]s[Y]
   ```
4. マッピングファイルから該当行を削除

### 完全アンインストール

1. すべてのアプリをアンインストール
2. PlayCover をアンマウント:
   ```bash
   diskutil unmount force ~/Library/Containers/io.playcover.PlayCover
   ```
3. すべてのボリュームを削除
4. `playcover-map.txt` を削除

---

## 📞 サポート情報

### 対応環境
- macOS Tahoe 26.0.1以降
- Apple Silicon Mac専用
- APFS対応ストレージ

### 既知の制限事項
- Intel Macは非対応
- HFS+フォーマッ��は非対応
- ネットワークドライブは非対応

### スクリプトバージョン
- 初期セットアップ: v1.0.0
- IPAインストール: v1.0.0
- 最終更新: 2025年10月24日
