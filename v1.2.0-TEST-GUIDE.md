# v1.2.0 テストガイド

## 新機能の概要

### 1. 日本語アプリ名の表示
- `ja.lproj/InfoPlist.strings` から日本語名を抽出
- 日本語名がなければ英語名にフォールバック
- ボリューム名は英語名ベース（互換性維持）

### 2. ボリューム作成の確認プロンプト
- ボリューム作成前に詳細情報を表示
- ユーザーが確認してから作成実行

### 3. アップデート確認の改善
- 既存アプリのバージョン表示
- 新規 IPA のバージョン表示
- 比較して判断可能

## テストシナリオ

### シナリオ A: 新規インストール

1. **実行**
   ```bash
   ./1_playcover-ipa-install.command
   ```

2. **IPA 選択**
   - まだインストールしていないアプリの IPA を選択

3. **確認ポイント**
   - ✅ IPA 情報取得で日本語名が表示される
   - ✅ バージョン情報が表示される
   - ✅ ボリューム作成前に確認プロンプトが表示される
   - ✅ アプリ名、バージョン、Bundle ID、ボリューム名が正しい

4. **期待される出力**
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
     07. IPA 情報の取得
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ✓ IPA 情報を取得しました
   ℹ アプリ名: 崩壊：スターレイル  ← 日本語名
   ℹ バージョン: 3.6.0
   ℹ Bundle ID: com.HoYoverse.hkrpgoversea
   ℹ ボリューム名: HonkaiStarRail
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
     09. アプリボリュームの作成
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
     ボリューム作成の確認
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
     アプリ名: 崩壊：スターレイル
     バージョン: 3.6.0
     Bundle ID: com.HoYoverse.hkrpgoversea
     ボリューム名: HonkaiStarRail
     作成先: disk5
   
   このボリュームを作成しますか？ (Y/n):
   ```

### シナリオ B: アップデート（既存アプリあり）

1. **実行**
   ```bash
   ./1_playcover-ipa-install.command
   ```

2. **IPA 選択**
   - 既にインストール済みのアプリの新しいバージョンを選択

3. **確認ポイント**
   - ✅ ボリューム作成スキップ（既存使用）
   - ✅ PlayCover インストール時に既存アプリを検出
   - ✅ 既存バージョンと新規バージョンが比較表示される
   - ✅ 上書き確認プロンプトが表示される

4. **期待される出力**
   ```
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
     12. PlayCover への IPA インストール
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   
   ⚠ アプリは既にインストールされています
   
     インストール済み:
       アプリ名: ゼンレスゾーンゼロ
       バージョン: 1.3.0  ← 古いバージョン
   
     インストール予定:
       アプリ名: ゼンレスゾーンゼロ
       バージョン: 1.4.0  ← 新しいバージョン
   
   上書き（アップデート）しますか？ (Y/n):
   ```

### シナリオ C: キャンセル操作

1. **ボリューム作成時にキャンセル**
   ```
   このボリュームを作成しますか？ (Y/n): n
   ```
   - ✅ 処理が中断される
   - ✅ クリーンに終了する

2. **アップデート時にキャンセル**
   ```
   上書き（アップデート）しますか？ (Y/n): n
   ```
   - ✅ インストールがスキップされる
   - ✅ 既存アプリは影響を受けない

### シナリオ D: 日本語名がない IPA

1. **英語のみのアプリで実行**
   - 海外製アプリなど

2. **確認ポイント**
   - ✅ 英語名が表示される
   - ✅ エラーにならない
   - ✅ ボリューム名は英語ベース

3. **期待される動作**
   ```
   ✓ IPA 情報を取得しました
   ℹ アプリ名: Honkai: Star Rail  ← 英語名
   ℹ バージョン: 3.6.0
   ℹ Bundle ID: com.HoYoverse.hkrpgoversea
   ℹ ボリューム名: HonkaiStarRail
   ```

## 既知の制限事項

### 日本語名の抽出

- **成功する場合**: `ja.lproj/InfoPlist.strings` が存在し、`CFBundleDisplayName` が定義されている
- **フォールバックする場合**: 
  - 日本語ローカライズファイルがない
  - `CFBundleDisplayName` が定義されていない
  - ファイルが破損している

### バージョン情報

- **`CFBundleShortVersionString`** を優先的に使用
- ない場合は **`CFBundleVersion`** を使用
- 両方ない場合は表示されない（エラーにはならない）

## トラブルシューティング

### 日本語名が表示されない

1. **IPA 内のローカライズファイルを確認**
   ```bash
   unzip -l your-app.ipa | grep "ja.lproj"
   ```

2. **手動確認**
   ```bash
   unzip -q your-app.ipa "Payload/*.app/ja.lproj/InfoPlist.strings" -d /tmp/
   plutil -p /tmp/Payload/*.app/ja.lproj/InfoPlist.strings
   ```

### ボリューム作成プロンプトが表示されない

- 既にボリュームが存在する場合は表示されません
- これは正常な動作です

### アップデート確認が表示されない

- PlayCover にアプリがインストールされていない場合は表示されません
- 確認パス: `~/Library/Containers/io.playcover.PlayCover/Data/Library/Application Support/io.playcover.PlayCover/PlayChain/`

## フィードバック

テスト結果を報告してください：

- ✅ 正常に動作したシナリオ
- ❌ 問題があったシナリオ
- 💡 改善提案

特に以下の点を確認してください：

1. 日本語名の抽出が正しく動作するか
2. バージョン情報が正確に表示されるか
3. 確認プロンプトが適切なタイミングで表示されるか
4. キャンセル操作が正しく動作するか
