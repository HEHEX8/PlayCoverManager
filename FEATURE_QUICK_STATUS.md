# Feature: Quick Status Display on Main Menu (v1.5.0)

## 概要
バージョン 1.5.0 では、メインメニュー画面に現在のボリュームマウント状況を表示する機能を追加しました。

---

## 機能の目的

### 問題点
**v1.4.2 以前:**
- ボリュームの状態を確認するには「オプション 4」を選択する必要があった
- メニュー画面では現在の状況が分からない
- 何度も状態確認とメニューを往復する必要があった

### 解決策
**v1.5.0:**
- メニュー画面に現在のマウント状況を自動表示
- オプション選択前に状況を把握できる
- より効率的なワークフロー

---

## 表示内容

### 1. サマリー情報
```
━━━━━━━━━━━━ 現在の状態 ━━━━━━━━━━━━

  🔌 マウント中: 2/4
  ⚪ アンマウント: 2/4
```

**表示項目:**
- **マウント中**: 外部ボリュームとしてマウントされているアプリ数
- **アンマウント**: アンマウント済みまたは内蔵ストレージのアプリ数
- **合計**: 登録されている全アプリ数

### 2. 個別ボリューム一覧
```
  【ボリューム一覧】
    🔌 崩壊：スターレイル
    🔌 原神
    ⚪ ゼンレスゾーンゼロ
    💾 Honkai Impact 3rd
```

**ステータスアイコン:**
| アイコン | 状態 | 説明 |
|---------|------|------|
| 🔌 | external | 外部ボリュームとしてマウント中 |
| 💾 | internal | 内蔵ストレージにデータあり |
| ⚪ | none | アンマウント済み（空） |
| ❓ | unknown | 状態不明 |

---

## 画面レイアウト

### 完全なメニュー表示例
```
╔═══════════════════════════════════════════════════════════╗
║                                                           ║
║            PlayCover ボリューム管理                        ║
║                                                           ║
║              macOS Tahoe 26.0.1 対応版                     ║
║                 Version 1.5.0                             ║
║                                                           ║
╚═══════════════════════════════════════════════════════════╝

━━━━━━━━━━━━ 現在の状態 ━━━━━━━━━━━━

  🔌 マウント中: 2/4
  ⚪ アンマウント: 2/4

  【ボリューム一覧】
    🔌 崩壊：スターレイル
    🔌 原神
    ⚪ ゼンレスゾーンゼロ
    💾 Honkai Impact 3rd

━━━━━━━━━━━━━━ メニュー ━━━━━━━━━━━━━━

  1. 全ボリュームをマウント
  2. 全ボリュームをアンマウント
  3. 個別ボリューム操作
  4. ボリューム状態確認
  5. ディスク全体を取り外し
  6. ストレージ切り替え（内蔵⇄外部）
  7. 終了

選択 (1-7):
```

---

## 技術実装

### 新規追加関数: `show_quick_status()`

**場所:** `2_playcover-volume-manager.command` (lines 1223-1289)

**処理フロー:**
```
1. マッピングファイルを読み込み
2. 各ボリュームの状態をチェック
3. マウント済み/アンマウント済みをカウント
4. サマリー情報を表示
5. 個別ボリューム一覧を表示
```

**実装コード（抜粋）:**
```bash
show_quick_status() {
    local mounted_count=0
    local unmounted_count=0
    local total_count=0
    
    # Count volumes by status
    while IFS=$'\t' read -r volume_name bundle_id display_name; do
        # Skip PlayCover main volume
        if [[ "$bundle_id" == "$PLAYCOVER_BUNDLE_ID" ]]; then
            continue
        fi
        
        ((total_count++))
        
        local target_path="${HOME}/Library/Containers/${bundle_id}"
        local storage_type=$(get_storage_type "$target_path")
        
        if [[ "$storage_type" == "external" ]]; then
            ((mounted_count++))
        else
            ((unmounted_count++))
        fi
    done < "$MAPPING_FILE"
    
    # Display status bar
    echo "${BLUE}━━━━━━━━━━━━ 現在の状態 ━━━━━━━━━━━━${NC}"
    echo ""
    
    if [[ $total_count -eq 0 ]]; then
        echo "  ${YELLOW}⚠${NC} 登録されているアプリがありません"
    else
        echo "  ${GREEN}🔌 マウント中:${NC} ${mounted_count}/${total_count}"
        echo "  ${YELLOW}⚪ アンマウント:${NC} ${unmounted_count}/${total_count}"
        
        # Show individual status (compact)...
    fi
}
```

### `show_menu()` の変更

**v1.4.2 以前:**
```bash
show_menu() {
    clear
    echo "${CYAN}"
    # Title display...
    echo ""
    echo "${BLUE}━━━━━━━━━━━━━━ メニュー ━━━━━━━━━━━━━━${NC}"
    # Menu options...
}
```

**v1.5.0:**
```bash
show_menu() {
    clear
    echo "${CYAN}"
    # Title display...
    echo ""
    
    # ★ 新規追加: クイックステータス表示
    show_quick_status()
    
    echo "${BLUE}━━━━━━━━━━━━━━ メニュー ━━━━━━━━━━━━━━${NC}"
    # Menu options...
}
```

---

## ユーザー体験の改善

### Before (v1.4.2)
```
ユーザーの操作フロー:
1. メニューを見る
2. 「4」を選択して状態確認
3. 状態を確認
4. メニューに戻る
5. 適切なオプションを選択
```

**問題点:**
- 状態確認のために余分な操作が必要
- メニューと状態確認を往復する非効率性
- 現在の状況が分からない状態で判断

### After (v1.5.0)
```
ユーザーの操作フロー:
1. メニューを開く
   → 自動的に現在の状態が表示される
2. 状態を確認（追加操作不要）
3. 適切なオプションを選択
```

**メリット:**
- ✅ 状態確認の手間が不要
- ✅ 1 ステップ削減
- ✅ より直感的な操作

---

## 使用例とシナリオ

### シナリオ 1: 起動時の状態確認
```bash
# ツールを起動
$ ./2_playcover-volume-manager.command

# 自動的に表示される
━━━━━━━━━━━━ 現在の状態 ━━━━━━━━━━━━

  🔌 マウント中: 3/4
  ⚪ アンマウント: 1/4

  【ボリューム一覧】
    🔌 崩壊：スターレイル
    🔌 原神
    🔌 ゼンレスゾーンゼロ
    ⚪ Honkai Impact 3rd

# → 一目で「3つマウント済み、1つアンマウント」と分かる
# → 必要なら「1」で全マウント、または「3」で個別操作
```

### シナリオ 2: 作業完了後の確認
```bash
# オプション 2 で全アンマウント実行
# → メニューに戻る

━━━━━━━━━━━━ 現在の状態 ━━━━━━━━━━━━

  🔌 マウント中: 0/4
  ⚪ アンマウント: 4/4

  【ボリューム一覧】
    ⚪ 崩壊：スターレイル
    ⚪ 原神
    ⚪ ゼンレスゾーンゼロ
    ⚪ Honkai Impact 3rd

# → すべてアンマウントされたことを即座に確認
# → オプション 4 で詳細確認する必要なし
```

### シナリオ 3: 混在状態の把握
```bash
━━━━━━━━━━━━ 現在の状態 ━━━━━━━━━━━━

  🔌 マウント中: 1/4
  ⚪ アンマウント: 3/4

  【ボリューム一覧】
    🔌 原神
    💾 崩壊：スターレイル       ← 内蔵ストレージで動作中
    ⚪ ゼンレスゾーンゼロ
    ⚪ Honkai Impact 3rd

# → 「原神」のみマウント中
# → 「崩壊：スターレイル」は内蔵ストレージで動作
# → 残り2つはアンマウント済み
```

---

## パフォーマンスへの影響

### 処理時間
- **ボリューム数**: 1-10個の場合
- **処理時間**: 〜50-200ms（ボリューム数による）
- **体感速度**: メニュー表示と同時なので遅延を感じない

### 最適化
1. **効率的なループ**: マッピングファイルを1回だけ読み込み
2. **キャッシュ不要**: 状態は常に最新（メニュー表示時に取得）
3. **軽量関数**: `get_storage_type()` は既存関数を再利用

---

## オプション 4 との違い

### オプション 4: 詳細な状態確認
```
ボリューム状態
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  1. 🔌 崩壊：スターレイル
     (外部ストレージ)
     マウント: /Users/user/Library/Containers/com.HoYoverse.hkrpgoversea
     
  2. ⚪ 原神
     (アンマウント済み)
     
  3. 💾 ゼンレスゾーンゼロ
     (内蔵ストレージ)
     パス: /Users/user/Library/Containers/com.HoYoverse.Nap
```

**特徴:**
- より詳細な情報（パス、マウントポイントなど）
- 複数画面にわたる可能性
- トラブルシューティング向け

### Quick Status: 簡潔な概要
```
  【ボリューム一覧】
    🔌 崩壊：スターレイル
    ⚪ 原神
    💾 ゼンレスゾーンゼロ
```

**特徴:**
- 最小限の情報（名前とアイコンのみ）
- 1画面に収まるコンパクトさ
- 日常操作向け

---

## 今後の拡張案

### 追加表示項目候補
1. **ディスク空き容量**
   ```
   💿 ディスク使用量: 45.2GB / 120GB (37%)
   ```

2. **最終マウント時刻**
   ```
   🔌 原神 (2時間前にマウント)
   ```

3. **エラー状態の強調**
   ```
   ❌ ゼンレスゾーンゼロ (ボリューム不在)
   ```

4. **フィルター表示**
   ```
   [フィルター: マウント中のみ表示]
   ```

### 設定オプション
- クイックステータスの表示/非表示切り替え
- コンパクト表示 vs 詳細表示
- カラースキームのカスタマイズ

---

## バージョン情報

**Version**: 1.5.0  
**Release Date**: 2025-01-15  
**Type**: Feature Enhancement  

**変更サマリー:**
- ✨ **新機能**: メニュー画面にクイックステータス表示
- 📊 **統計表示**: マウント中/アンマウントのカウント
- 📋 **一覧表示**: 全ボリュームのコンパクトリスト
- 🎨 **UI改善**: 直感的なアイコンと色分け

**互換性:**
- ✅ v1.4.x と完全互換
- ✅ 既存機能への影響なし
- ✅ パフォーマンスへの影響最小

---

## まとめ

**v1.5.0 で達成したこと:**
1. ✅ メニュー画面で状態を即座に把握
2. ✅ 状態確認の操作手順を削減
3. ✅ より効率的なワークフロー
4. ✅ 直感的なUI/UX

**ユーザーメリット:**
- より速い意思決定
- 無駄な操作の削減
- 現在の状況の明確な把握
- ストレスフリーな管理体験

**今後の方向性:**
- さらなる情報の追加
- カスタマイズオプション
- パフォーマンスの最適化
- ユーザーフィードバックの反映
