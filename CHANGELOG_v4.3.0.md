# PlayCover Complete Manager v4.3.0 変更ログ

## リリース日: 2025-10-25

## 🎯 主要な機能追加: アプリ管理メニュー（インストール + アンインストール）

### 背景
v4.2.1までは、IPAのインストール機能のみが提供されていました。ユーザーからの要望により、アプリのアンインストール機能を追加し、**アプリ管理メニュー**として統合しました。

### 実装した機能

#### 1. アプリ管理メニューの追加

**メインメニューの変更:**
```
【インストール】 → 【アプリ管理】
```

**新しいサブメニュー構成:**
```
▼ アプリ管理メニュー

  1. IPAをインストール
  2. アプリをアンインストール
  
  0. メインメニューに戻る
```

#### 2. アンインストール機能の実装

**機能概要:**
- インストール済みアプリの一覧表示
- 対話的なアプリ選択
- 完全なアンインストール処理

**アンインストール処理の内容:**

```bash
1. PlayCover からアプリを削除
   ├─ Applications/[BundleID].app の削除
   └─ App Settings/[BundleID].plist の削除

2. APFSボリュームのアンマウント
   └─ diskutil unmount

3. APFSボリュームの削除
   └─ diskutil apfs deleteVolume

4. マッピング情報の削除
   └─ playcover-map.txt から該当行を削除
```

### コード変更箇所

**ファイル**: `playcover-complete-manager.command`

1. **Module 15.5: App Management Menu** (新規追加)
   - `app_management_menu()` - アプリ管理メニュー表示
   - `uninstall_workflow()` - アンインストール処理フロー

2. **メインメニュー表示の変更** (lines 2236-2248)
   ```bash
   # 変更前
   【インストール】
   1. IPA をインストール
   
   # 変更後
   【アプリ管理】
   1. アプリ管理メニュー
   ```

3. **メインループの変更** (lines 3205-3239)
   ```bash
   case "$choice" in
       1)
           # 変更前: install_workflow
           # 変更後: app_management_menu
           app_management_menu
           ;;
   ```

### アンインストール機能の詳細

#### ユーザーインターフェース

1. **アプリ一覧表示**
   ```
   インストールされているアプリ:
   
     1. 原神
        Bundle ID: com.miHoYo.GenshinImpact
        ボリューム: GenshinImpact-volume
   
     2. 崩壊：スターレイル
        Bundle ID: com.HoYoverse.hkrpgoversea
        ボリューム: Honkai-StarRail-volume
   ```

2. **確認プロンプト**
   ```
   ⚠ 以下のアプリをアンインストールします:
   
     アプリ名: 原神
     Bundle ID: com.miHoYo.GenshinImpact
     ボリューム: GenshinImpact-volume
   
   ⚠ この操作は以下を実行します:
     1. PlayCover からアプリを削除
     2. APFSボリュームをアンマウント
     3. APFSボリュームを削除
     4. マッピング情報を削除
   
   ❌ この操作は取り消せません！
   
   本当にアンインストールしますか？ (yes/NO):
   ```

3. **処理進行状況**
   ```
   ℹ アンインストールを開始します...
   
   ℹ PlayCover からアプリを削除中...
   ✓ アプリを削除しました
   
   ℹ アプリ設定を削除中...
   ✓ 設定を削除しました
   
   ℹ ボリュームをアンマウント中...
   ✓ ボリュームをアンマウントしました
   
   ℹ APFSボリュームを削除中...
   ✓ ボリュームを削除しました
   
   ℹ マッピング情報を削除中...
   ✓ マッピング情報を削除しました
   
   ✓ アンインストールが完了しました
   
   削除したアプリ: 原神
   ```

#### 安全機能

1. **二重確認**
   - 数字選択 → "yes" 入力による二段階確認
   - 誤操作防止

2. **取り消し不可警告**
   - 明確な警告メッセージ
   - 赤色テキストで強調

3. **ロック機構**
   - マッピングファイルの排他制御
   - データ破損防止

4. **エラーハンドリング**
   - 各ステップでのエラー検出
   - 失敗時の適切なメッセージ表示

### バージョン更新内容

```
v4.2.1 → v4.3.0
- 行数: 2966行 → 3276行 (+310行)
- サイズ: 107KB → 118KB (+11KB)
- 新規関数: app_management_menu(), uninstall_workflow()
- 変更関数: show_menu(), main()
```

### 使用シーン

#### シーン1: 不要なアプリの削除
```
ユーザー: 「テスト用にインストールしたアプリを完全に削除したい」
→ アプリ管理 → アンインストール → 対象アプリ選択 → yes確認
→ アプリ、ボリューム、マッピングが完全削除される
```

#### シーン2: ディスク容量の確保
```
ユーザー: 「大きなゲームアプリをアンインストールして容量を空けたい」
→ アプリ管理 → アンインストール → 対象ゲーム選択
→ APFSボリュームごと削除されるため、確実に容量が解放される
```

#### シーン3: クリーンな再インストール
```
ユーザー: 「アプリが不調なので、完全削除してから再インストールしたい」
→ アンインストール → クリーン削除完了
→ IPAインストール → 新規インストール
```

### ユーザーへの影響

**ポジティブな影響:**
- ✅ 不要なアプリを簡単に削除できる
- ✅ ボリュームを含めた完全削除が可能
- ✅ ディスク容量を確実に解放できる
- ✅ マッピング情報も自動で削除される
- ✅ 対話的UIで安全に操作できる

**注意事項:**
- ⚠️ アンインストールは取り消せない
- ⚠️ アプリデータも完全に削除される
- ⚠️ バックアップが必要な場合は事前に実施

### 次回以降の改善案

1. **バックアップオプション**
   - アンインストール前の自動バックアップ

2. **一括アンインストール**
   - 複数アプリの同時削除

3. **アプリ情報の詳細表示**
   - アプリサイズ、インストール日時の表示

---

## まとめ

v4.3.0では、待望のアンインストール機能を追加し、**アプリ管理メニュー**として統合しました。これにより、IPAのインストールからアンインストールまで、すべてのアプリライフサイクル管理が1つのスクリプトで完結します。

**主な改善点:**
- 【インストール】 → 【アプリ管理】メニューに拡張
- IPAインストール機能を継承（変更なし）
- 新規: アンインストール機能（完全削除）
- 対話的UI + 二重確認による安全性

**推奨**: すべてのユーザーは v4.3.0 へのアップグレードを推奨します。既存機能はそのまま動作し、新しいアンインストール機能により、より完全なアプリ管理が可能になります。
